{"version":3,"sources":["file:///Users/qinx/coding/cocos2dx/Cocos2dx-taxi/assets/script/game/GameCtrl.ts"],"names":["_decorator","Component","Node","BoxCollider","Constants","CustomEventListener","UIManager","AudioManager","CarManager","MapManager","ccclass","property","GameCtrl","type","onLoad","mapManager","resetMap","carManager","reset","curPath","collider","group","getComponent","setGroup","CarGroup","NORMAL","setMask","start","showDialog","UIPage","mainUI","node","on","EventType","TOUCH_START","_touchStart","TOUCH_END","_touchEnd","EventName","GAME_START","_gameStart","GAME_OVER","_gameOver","NEW_LEVEL","_newLevel","playMusic","touch","event","controMoving","hidDialog","gameUI","resultUI"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, EventTouch, BoxColliderComponent, BoxCollider, Vec3 } from 'cc';\nimport { Constants } from '../data/Constants';\nimport { CustomEventListener } from '../data/CustomEventListener';\nimport { UIManager } from '../ui/UIManager';\nimport { AudioManager } from './AudioManager';\nimport { CarManager } from './CarManager';\nimport { MapManager } from './MapManager';\nconst { ccclass, property } = _decorator;\n\n@ccclass('GameCtrl')\nexport class GameCtrl extends Component {\n  @property({\n    type: MapManager\n  })\n  mapManager: MapManager = null;\n\n  @property({\n    type: CarManager\n  })\n  carManager: CarManager = null;\n\n  @property({\n    type: Node,\n  })\n  group: Node = null!;\n\n  public onLoad() {\n    this.mapManager!.resetMap();\n    this.carManager!.reset(this.mapManager!.curPath);\n    const collider = this.group.getComponent(BoxCollider)!;\n    collider.setGroup(Constants.CarGroup.NORMAL);\n    collider.setMask(-1);\n  }\n\n  public start() {\n    UIManager.showDialog(Constants.UIPage.mainUI);\n\n    this.node.on(Node.EventType.TOUCH_START, this._touchStart, this);\n    this.node.on(Node.EventType.TOUCH_END, this._touchEnd, this);\n    CustomEventListener.on(Constants.EventName.GAME_START, this._gameStart);\n    CustomEventListener.on(Constants.EventName.GAME_OVER, this._gameOver);\n    CustomEventListener.on(Constants.EventName.NEW_LEVEL, this._newLevel);\n\n    AudioManager.playMusic();\n  }\n\n  private _touchStart(touch: Touch, event: EventTouch) {\n    this.carManager?.controMoving();\n  }\n\n  private _touchEnd(touch: Touch, event: EventTouch) {\n    this.carManager?.controMoving(false);\n  }\n\n\n  private _gameStart() {\n    UIManager.hidDialog(Constants.UIPage.mainUI);\n    UIManager.showDialog(Constants.UIPage.gameUI);\n  }\n\n  private _gameOver() {\n    UIManager.hidDialog(Constants.UIPage.gameUI);\n    UIManager.showDialog(Constants.UIPage.resultUI);\n  }\n\n  private _newLevel() {\n    UIManager.hidDialog(Constants.UIPage.resultUI);\n    UIManager.showDialog(Constants.UIPage.mainUI);\n  }\n}\n\n"]}