{"version":3,"sources":["file:///Users/qinx/coding/cocos2dx/Cocos2dx-taxi/assets/script/data/CustomEventListener.ts"],"names":["_decorator","Component","ccclass","property","CustomEventListener","on","eventName","cb","target","handle","data","func","push","off","list","length","i","event","splice","dispatchEvent","args","apply"],"mappings":";;;;;;;;;;AACSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;;;;;;;OACf;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBH,U;;qCAYjBI,mB,WADZF,OAAO,CAAC,qBAAD,C,mCAAR,MACaE,mBADb,SACyCH,SADzC,CACmD;AAGjC,eAAFI,EAAE,CAACC,SAAD,EAAoBC,EAApB,EAAiCC,MAAjC,EAA6C;AAC3D,cAAG,CAAC,KAAKC,MAAL,CAAYH,SAAZ,CAAJ,EAA2B;AACzB,iBAAKG,MAAL,CAAYH,SAAZ,IAAyB,EAAzB;AACD,WAH0D,CAK3D;;;AACA,gBAAMI,IAAgB,GAAG;AAACC,YAAAA,IAAI,EAAEJ,EAAP;AAAWC,YAAAA;AAAX,WAAzB;AACA,eAAKC,MAAL,CAAYH,SAAZ,EAAuBM,IAAvB,CAA4BF,IAA5B;AAED;;AAEgB,eAAHG,GAAG,CAACP,SAAD,EAAoBC,EAApB,EAAiCC,MAAjC,EAA8C;AAC7D,gBAAMM,IAAI,GAAG,KAAKL,MAAL,CAAYH,SAAZ,CAAb;;AACA,cAAG,CAACQ,IAAD,IAASA,IAAI,CAACC,MAAL,IAAc,CAA1B,EAA4B;AAC1B;AACD;;AAED,eAAI,IAAIC,CAAC,GAAC,CAAV,EAAaA,CAAC,GAACF,IAAI,CAACC,MAApB,EAA4BC,CAAC,EAA7B,EAAgC;AAC9B,kBAAMC,KAAK,GAAGH,IAAI,CAACE,CAAD,CAAlB;;AACA,gBAAGC,KAAK,CAACN,IAAN,KAAeJ,EAAf,KACG,CAACC,MAAD,IAAWA,MAAM,KAAKS,KAAK,CAACT,MAD/B,CAAH,EAC0C;AACtCM,cAAAA,IAAI,CAACI,MAAL,CAAYF,CAAZ,EAAe,CAAf;AACA;AACD;AACJ;AACF;;AAE0B,eAAbG,aAAa,CAACb,SAAD,EAAoB,GAAGc,IAAvB,EAAgC;AACzD,gBAAMN,IAAI,GAAG,KAAKL,MAAL,CAAYH,SAAZ,CAAb;;AACA,cAAG,CAACQ,IAAD,IAASA,IAAI,CAACC,MAAL,IAAc,CAA1B,EAA4B;AAC1B;AACD;;AAED,eAAI,IAAIC,CAAC,GAAC,CAAV,EAAaA,CAAC,GAACF,IAAI,CAACC,MAApB,EAA4BC,CAAC,EAA7B,EAAgC;AAC9B,kBAAMC,KAAK,GAAGH,IAAI,CAACE,CAAD,CAAlB;AACAC,YAAAA,KAAK,CAACN,IAAN,CAAWU,KAAX,CAAiBJ,KAAK,CAACT,MAAvB,EAA+BY,IAA/B;AACD;AACF;;AAxCgD,O,qCAClB,E","sourcesContent":["\nimport { _decorator, Component, Node } from 'cc';\nconst { ccclass, property } = _decorator;\n\ninterface  IEventData{\n  func: Function;\n  target: any;\n}\n\ninterface IEvent{\n  [eventName: string]: IEventData[];\n}\n\n@ccclass('CustomEventListener')\nexport class CustomEventListener extends Component {\n  public static handle: IEvent = {};\n\n  public static on(eventName: string, cb:Function, target?:any){\n    if(!this.handle[eventName]){\n      this.handle[eventName] = [];\n    }\n\n    // this 指向性问题，才能理解 target? 工作\n    const data: IEventData = {func: cb, target}\n    this.handle[eventName].push(data);\n\n  }\n\n  public static off(eventName: string, cb:Function, target?: any){\n    const list = this.handle[eventName];\n    if(!list || list.length <=0){\n      return;\n    }\n\n    for(let i=0; i<list.length; i++){\n      const event = list[i]; \n      if(event.func === cb \n        && (!target || target === event.target)){\n          list.splice(i, 1)\n          break;\n        }\n    }\n  }\n\n  public static dispatchEvent(eventName: string, ...args:any){\n    const list = this.handle[eventName];\n    if(!list || list.length <=0){\n      return;\n    }\n\n    for(let i=0; i<list.length; i++){\n      const event = list[i];\n      event.func.apply(event.target, args)\n    }\n  }\n}"]}