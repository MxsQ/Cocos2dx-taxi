{"version":3,"sources":["file:///Users/qinx/coding/cocos2dx/Cocos2dx-taxi/assets/script/RoadPoint.ts"],"names":["_decorator","Component","Node","Vec3","Enum","macro","ccclass","property","ROAD_POINT_TYPE","ROAD_MOVE_TYPE","RoadPoint","type","visible","END","moveType","CURVE","BEND","GREETING","GOODBYE","AI_START","start","_arrCars","cars","split","startSchedule","cd","stopSchedule","_cd","scheduleOnce","_startDeley","delayTime","unschedule","_scheduleCD","schedule","interval","REPEAT_FOREVER","index","Math","floor","random","length","NORMAL","LINE"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, Vec3, Enum, macro } from 'cc';\nconst { ccclass, property } = _decorator;\n\nenum ROAD_POINT_TYPE {\n  NORMAL = 1,\n  START,   // 玩家小车用\n  GREETING,\n  GOODBYE,\n  END,\n  AI_START, // 生成的小车用\n}\n\nEnum(ROAD_POINT_TYPE);\n\nenum ROAD_MOVE_TYPE {\n  LINE = 1,\n  CURVE,\n  BEND,\n}\n\nEnum(ROAD_MOVE_TYPE);\n\n@ccclass('RoadPoint')\nexport class RoadPoint extends Component {\n  public static RoadPointType = ROAD_POINT_TYPE;\n  public static RoadMoveType = ROAD_MOVE_TYPE;\n\n\n  @property({ type: ROAD_POINT_TYPE })\n  type = ROAD_POINT_TYPE.NORMAL;\n\n  @property({\n    type: Node,\n    visible: function (this: RoadPoint) {\n      return this.type !== ROAD_POINT_TYPE.END;\n    }\n  })\n  nextStation: Node = null;\n\n  @property({\n    type: ROAD_MOVE_TYPE,\n    visible: function (this: RoadPoint) {\n      return this.type !== ROAD_POINT_TYPE.END;\n    }\n  })\n  moveType = ROAD_MOVE_TYPE.LINE;\n\n  @property({\n    visible: function (this: RoadPoint) {\n      return this.type !== ROAD_POINT_TYPE.END && (this.moveType === ROAD_MOVE_TYPE.CURVE || this.moveType === ROAD_MOVE_TYPE.BEND);\n    }\n  })\n  clockwise = true;\n\n  @property({\n    type: Vec3,\n    visible: function (this: RoadPoint) {\n      return this.type === ROAD_POINT_TYPE.GREETING\n        || this.type === ROAD_POINT_TYPE.GOODBYE;\n    }\n  })\n  direction = new Vec3(1, 0, 0);\n\n  @property({\n    visible: function (this: RoadPoint) {\n      return this.type === ROAD_POINT_TYPE.AI_START;\n    }\n  })\n  interval = 3;\n\n  @property({\n    visible: function (this: RoadPoint) {\n      return this.type === ROAD_POINT_TYPE.AI_START;\n    }\n  })\n  delayTime = 0;\n\n  @property({\n    visible: function (this: RoadPoint) {\n      return this.type === ROAD_POINT_TYPE.AI_START;\n    }\n  })\n  speed = 0.05;\n\n  @property({\n    visible: function (this: RoadPoint) {\n      return this.type === ROAD_POINT_TYPE.AI_START;\n    }\n  })\n  cars = \"201\";\n\n  private _arrCars: string[] = [];\n  private _cd: Function = null;\n\n  public start() {\n    this._arrCars = this.cars.split(',')\n  }\n\n  public startSchedule(cd: Function) {\n    if (this.type !== ROAD_POINT_TYPE.AI_START) {\n      return;\n    }\n\n    this.stopSchedule();\n    this._cd = cd;\n    this.scheduleOnce(this._startDeley, this.delayTime);\n  }\n\n  public stopSchedule() {\n    this.unschedule(this._startDeley);\n    this.unschedule(this._scheduleCD);\n  }\n\n  private _startDeley() {\n    this._scheduleCD();\n    this.schedule(this._scheduleCD, this.interval, macro.REPEAT_FOREVER);\n  }\n\n  private _scheduleCD() {\n    const index = Math.floor(Math.random() * this._arrCars.length);\n    if (this._cd) {\n      this._cd(this, this._arrCars[index]);\n    }\n  }\n}\n\n"]}