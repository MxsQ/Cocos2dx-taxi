{"version":3,"sources":["file:///Users/qinx/coding/cocos2dx/Cocos2dx-taxi/assets/script/data/CustomEventListener.ts"],"names":["_decorator","Component","ccclass","property","CustomEventListener","on","eventName","cb","target","handle","data","func","push","off","list","length","i","event","splice","dispatchEvent","args","apply"],"mappings":";;;;;;;;;;;;;;AACSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;;;;;;;AACbC,MAAAA,O,GAAsBF,U,CAAtBE,O;AAASC,MAAAA,Q,GAAaH,U,CAAbG,Q;;qCAYJC,mB,WADZF,OAAO,CAAC,qBAAD,C;;;;;;;4BAIQG,E,GAAd,YAAiBC,SAAjB,EAAoCC,EAApC,EAAkDC,MAAlD,EAAgE;AAC9D,cAAI,CAAC,KAAKC,MAAL,CAAYH,SAAZ,CAAL,EAA6B;AAC3B,iBAAKG,MAAL,CAAYH,SAAZ,IAAyB,EAAzB;AACD,WAH6D,CAK9D;;;AACA,cAAMI,IAAgB,GAAG;AAAEC,YAAAA,IAAI,EAAEJ,EAAR;AAAYC,YAAAA,MAAM,EAANA;AAAZ,WAAzB;AACA,eAAKC,MAAL,CAAYH,SAAZ,EAAuBM,IAAvB,CAA4BF,IAA5B;AAED,S;;4BAEaG,G,GAAd,aAAkBP,SAAlB,EAAqCC,EAArC,EAAmDC,MAAnD,EAAiE;AAC/D,cAAMM,IAAI,GAAG,KAAKL,MAAL,CAAYH,SAAZ,CAAb;;AACA,cAAI,CAACQ,IAAD,IAASA,IAAI,CAACC,MAAL,IAAe,CAA5B,EAA+B;AAC7B;AACD;;AAED,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,IAAI,CAACC,MAAzB,EAAiCC,CAAC,EAAlC,EAAsC;AACpC,gBAAMC,KAAK,GAAGH,IAAI,CAACE,CAAD,CAAlB;;AACA,gBAAIC,KAAK,CAACN,IAAN,KAAeJ,EAAf,KACE,CAACC,MAAD,IAAWA,MAAM,KAAKS,KAAK,CAACT,MAD9B,CAAJ,EAC2C;AACzCM,cAAAA,IAAI,CAACI,MAAL,CAAYF,CAAZ,EAAe,CAAf;AACA;AACD;AACF;AACF,S;;4BAEaG,a,GAAd,uBAA4Bb,SAA5B,EAA6D;AAC3D,cAAMQ,IAAI,GAAG,KAAKL,MAAL,CAAYH,SAAZ,CAAb;;AACA,cAAI,CAACQ,IAAD,IAASA,IAAI,CAACC,MAAL,IAAe,CAA5B,EAA+B;AAC7B;AACD;;AAJ0D,4CAAXK,IAAW;AAAXA,YAAAA,IAAW;AAAA;;AAM3D,eAAK,IAAIJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,IAAI,CAACC,MAAzB,EAAiCC,CAAC,EAAlC,EAAsC;AACpC,gBAAMC,KAAK,GAAGH,IAAI,CAACE,CAAD,CAAlB;AACAC,YAAAA,KAAK,CAACN,IAAN,CAAWU,KAAX,CAAiBJ,KAAK,CAACT,MAAvB,EAA+BY,IAA/B;AACD;AACF,S;;;QAxCsCnB,S,sCACR,E","sourcesContent":["\nimport { _decorator, Component, Node } from 'cc';\nconst { ccclass, property } = _decorator;\n\ninterface IEventData {\n  func: Function;\n  target: any;\n}\n\ninterface IEvent {\n  [eventName: string]: IEventData[];\n}\n\n@ccclass('CustomEventListener')\nexport class CustomEventListener extends Component {\n  public static handle: IEvent = {};\n\n  public static on(eventName: string, cb: Function, target?: any) {\n    if (!this.handle[eventName]) {\n      this.handle[eventName] = [];\n    }\n\n    // this 指向性问题，才能理解 target? 工作\n    const data: IEventData = { func: cb, target }\n    this.handle[eventName].push(data);\n\n  }\n\n  public static off(eventName: string, cb: Function, target?: any) {\n    const list = this.handle[eventName];\n    if (!list || list.length <= 0) {\n      return;\n    }\n\n    for (let i = 0; i < list.length; i++) {\n      const event = list[i];\n      if (event.func === cb\n        && (!target || target === event.target)) {\n        list.splice(i, 1)\n        break;\n      }\n    }\n  }\n\n  public static dispatchEvent(eventName: string, ...args: any) {\n    const list = this.handle[eventName];\n    if (!list || list.length <= 0) {\n      return;\n    }\n\n    for (let i = 0; i < list.length; i++) {\n      const event = list[i];\n      event.func.apply(event.target, args)\n    }\n  }\n}"]}