{"version":3,"sources":["file:///Users/qinx/coding/cocos2dx/Cocos2dx-taxi/assets/script/game/EffectManager.ts"],"names":["_decorator","Component","Prefab","ParticleUtils","ParticleSystemComponent","instantiate","Constants","CustomEventListener","PoolManager","ccclass","property","EffectManager","type","update","_curBraking","_followTarget","setWorldPosition","worldPosition","start","on","EventName","STARTBRA_KING","_startBraking","END_BRANING","_endBraking","SHOW_COIN","_showCoin","follow","getNode","brakeTrail","node","setWorldRotation","play","curBraking","scheduleOnce","setNode","pos","_coin","coin","setParent","getComponent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,a,OAAAA,a;AAAeC,MAAAA,uB,OAAAA,uB;AAAyBC,MAAAA,W,OAAAA,W;;AAC7EC,MAAAA,S,kBAAAA,S;;AACAC,MAAAA,mB,4BAAAA,mB;;AACAC,MAAAA,W,oBAAAA,W;;;;;;;AACDC,MAAAA,O,GAAsBT,U,CAAtBS,O;AAASC,MAAAA,Q,GAAaV,U,CAAbU,Q;;+BAGJC,a,WADZF,OAAO,CAAC,eAAD,C,UAGLC,QAAQ,CAAC;AACRE,QAAAA,IAAI,EAAEV;AADE,OAAD,C,UAKRQ,QAAQ,CAAC;AACRE,QAAAA,IAAI,EAAEV;AADE,OAAD,C;;;;;;;;;;;;;;;;0EAK4B,I;;wEACF,I;;kEACM,I;;;;;;;AACzC;eAEOW,M,GAAP,kBAAgB;AACd,cAAI,KAAKC,WAAL,IAAoB,KAAKC,aAA7B,EAA4C;AAC1C,iBAAKD,WAAL,CAAiBE,gBAAjB,CAAkC,KAAKD,aAAL,CAAmBE,aAArD;AACD;AACF,S;;eAEMC,K,GAAP,iBAAe;AACb;AAAA;AAAA,0DAAoBC,EAApB,CAAuB;AAAA;AAAA,sCAAUC,SAAV,CAAoBC,aAA3C,EAA0D,KAAKC,aAA/D,EAA8E,IAA9E;AACA;AAAA;AAAA,0DAAoBH,EAApB,CAAuB;AAAA;AAAA,sCAAUC,SAAV,CAAoBG,WAA3C,EAAwD,KAAKC,WAA7D,EAA0E,IAA1E;AACA;AAAA;AAAA,0DAAoBL,EAApB,CAAuB;AAAA;AAAA,sCAAUC,SAAV,CAAoBK,SAA3C,EAAsD,KAAKC,SAA3D,EAAsE,IAAtE;AACD,S;;eAEOJ,a,GAAR,yBAAsC;AACpC,cAAMK,MAAM,GAAG,KAAKZ,aAAL,mDAAf;AACA,eAAKD,WAAL,GAAmB;AAAA;AAAA,0CAAYc,OAAZ,CAAoB,KAAKC,UAAzB,EAAqC,KAAKC,IAA1C,CAAnB;;AACA,eAAKhB,WAAL,CAAiBiB,gBAAjB,CAAkCJ,MAAlC;;AACAxB,UAAAA,aAAa,CAAC6B,IAAd,CAAmB,KAAKlB,WAAxB;AACD,S;;eAEOU,W,GAAR,uBAAsB;AACpB,cAAMS,UAAU,GAAG,KAAKnB,WAAxB;AACA,eAAKoB,YAAL,CAAkB,YAAM;AACtB;AAAA;AAAA,4CAAYC,OAAZ,CAAoBF,UAApB;AACD,WAFD,EAEG,CAFH;AAIA,eAAKnB,WAAL,GAAmB,IAAnB;AACA,eAAKC,aAAL,GAAqB,IAArB;AACD,S;;eAEOW,S,GAAR,qBAAgC;AAC9B,cAAMU,GAAG,mDAAT;;AACA,cAAI,CAAC,KAAKC,KAAV,EAAiB;AACf,gBAAMC,IAAI,GAAGjC,WAAW,CAAC,KAAKiC,IAAN,CAAxB;AACAA,YAAAA,IAAI,CAACC,SAAL,CAAe,KAAKT,IAApB;AACA,iBAAKO,KAAL,GAAaC,IAAI,CAACE,YAAL,CAAkBpC,uBAAlB,CAAb;AACD;;AAED,eAAKiC,KAAL,CAAWP,IAAX,CAAgBd,gBAAhB,CAAiCoB,GAAjC;;AACA,eAAKC,KAAL,CAAWL,IAAX;AACD,S;;;QAxDgC/B,S;;;;;iBAKZ,I;;;;;;;iBAKQ,I","sourcesContent":["\nimport { _decorator, Component, Node, Prefab, ParticleUtils, ParticleSystemComponent, instantiate } from 'cc';\nimport { Constants } from '../data/Constants';\nimport { CustomEventListener } from '../data/CustomEventListener';\nimport { PoolManager } from '../data/PoolManager';\nconst { ccclass, property } = _decorator;\n\n@ccclass('EffectManager')\nexport class EffectManager extends Component {\n\n  @property({\n    type: Prefab\n  })\n  brakeTrail: Prefab = null;\n\n  @property({\n    type: Prefab\n  })\n  coin: Prefab | Node | null = null;\n\n  private _followTarget: Node | null = null;\n  private _curBraking: Node | null = null;\n  private _coin: ParticleSystemComponent = null;\n  // privete _coin: ParticleSystemComponent = null;\n\n  public update() {\n    if (this._curBraking && this._followTarget) {\n      this._curBraking.setWorldPosition(this._followTarget.worldPosition);\n    }\n  }\n\n  public start() {\n    CustomEventListener.on(Constants.EventName.STARTBRA_KING, this._startBraking, this);\n    CustomEventListener.on(Constants.EventName.END_BRANING, this._endBraking, this);\n    CustomEventListener.on(Constants.EventName.SHOW_COIN, this._showCoin, this);\n  }\n\n  private _startBraking(...args: any[]) {\n    const follow = this._followTarget = args[0];\n    this._curBraking = PoolManager.getNode(this.brakeTrail, this.node);\n    this._curBraking.setWorldRotation(follow);\n    ParticleUtils.play(this._curBraking);\n  }\n\n  private _endBraking() {\n    const curBraking = this._curBraking!;\n    this.scheduleOnce(() => {\n      PoolManager.setNode(curBraking);\n    }, 2);\n\n    this._curBraking = null;\n    this._followTarget = null;\n  }\n\n  private _showCoin(...args: any) {\n    const pos = args[0];\n    if (!this._coin) {\n      const coin = instantiate(this.coin) as Node;\n      coin.setParent(this.node);\n      this._coin = coin.getComponent(ParticleSystemComponent) as ParticleSystemComponent;\n    }\n\n    this._coin.node.setWorldPosition(pos);\n    this._coin.play();\n  }\n\n}"]}