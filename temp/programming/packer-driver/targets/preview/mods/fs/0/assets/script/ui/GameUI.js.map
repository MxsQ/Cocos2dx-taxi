{"version":3,"sources":["file:///Users/qinx/coding/cocos2dx/Cocos2dx-taxi/assets/script/ui/GameUI.ts"],"names":["_decorator","Component","Node","Label","SpriteFrame","Sprite","loader","AnimationComponent","Constants","CustomEventListener","RunTimeData","ccclass","property","GameUI","type","displayOrder","show","on","EventName","GREETING","_greeting","GOODBYE","_taking","SHOW_TALK","_talking","SHOW_GUIDE","_showGuide","_runtimeData","instance","_refreshUI","hide","off","progress","maxProgress","curProgress","spriteFrame","progress2","progress1","targetSp","levelFinished","customerID","table","talkable","index","Math","floor","random","length","str","content","string","path","loadRes","err","sp","talkNode","active","avatar","scheduleOnce","isShow","guildNode","animComp","getComponent","play","i","node","progress3","srcLevel","targetLevel","srcSp","levelUnFinished"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, Label, LabelComponent, SpriteComponent, SpriteFrame, Sprite, loader, AnimationComponent } from 'cc';\nimport { Constants } from '../data/Constants';\nimport { CustomEventListener } from '../data/CustomEventListener';\nimport { RunTimeData } from '../data/GameData';\nconst { ccclass, property } = _decorator;\n\n@ccclass('GameUI')\nexport class GameUI extends Component {\n  @property({\n    type: Label,\n    displayOrder: 1,\n  })\n  targetLevel: Label = null;\n\n  @property({\n    type: Label,\n    displayOrder: 2,\n  })\n  srcLevel: Label = null;\n\n  @property({\n    type: Sprite,\n    displayOrder: 3,\n  })\n  targetSp: Sprite = null;\n\n  @property({\n    type: Sprite,\n    displayOrder: 4,\n  })\n  srcSp: Sprite = null;\n\n  @property({\n    type: SpriteFrame,\n    displayOrder: 5,\n  })\n  levelFinished: SpriteFrame = null;\n\n  @property({\n    type: SpriteFrame,\n    displayOrder: 6,\n  })\n  levelUnFinished: SpriteFrame = null;\n\n  @property({\n    type: [Sprite],\n    displayOrder: 7,\n  })\n  progress: Sprite[] = [];\n\n  @property({\n    type: SpriteFrame,\n    displayOrder: 8,\n  })\n  progress1: SpriteFrame = null;\n\n  @property({\n    type: SpriteFrame,\n    displayOrder: 9,\n  })\n  progress2: SpriteFrame = null;\n\n  @property({\n    type: SpriteFrame,\n    displayOrder: 10,\n  })\n  progress3: SpriteFrame = null;\n\n  @property({\n    type: Sprite,\n    displayOrder: 11,\n  })\n  avatar: Sprite = null;\n\n  @property({\n    type: Label,\n    displayOrder: 12,\n  })\n  content: Label = null;\n\n  @property({\n    type: Node,\n    displayOrder: 13,\n  })\n  guildNode: Node = null;\n\n  @property({\n    type: Node,\n    displayOrder: 14,\n  })\n  talkNode: Node = null;\n\n  private _runtimeData: RunTimeData = null;\n\n  public show() {\n    CustomEventListener.on(Constants.EventName.GREETING, this._greeting, this);\n    CustomEventListener.on(Constants.EventName.GOODBYE, this._taking, this);\n    CustomEventListener.on(Constants.EventName.SHOW_TALK, this._talking, this);\n    CustomEventListener.on(Constants.EventName.SHOW_GUIDE, this._showGuide, this);\n    this._runtimeData = RunTimeData.instance();\n    this._refreshUI();\n    this._showGuide(true);\n  }\n\n  public hide() {\n    CustomEventListener.off(Constants.EventName.GREETING, this._greeting, this);\n    CustomEventListener.off(Constants.EventName.GOODBYE, this._taking, this);\n    CustomEventListener.off(Constants.EventName.SHOW_TALK, this._talking, this);\n    CustomEventListener.off(Constants.EventName.SHOW_GUIDE, this._showGuide, this);\n\n  }\n\n  private _greeting() {\n    this.progress[this._runtimeData.maxProgress - 1 - this._runtimeData.curProgress].spriteFrame = this.progress2;\n  }\n\n  private _taking() {\n    this.progress[this._runtimeData.maxProgress - this._runtimeData.curProgress].spriteFrame = this.progress1;\n    if (this._runtimeData.maxProgress === this._runtimeData.curProgress) {\n      this.targetSp.spriteFrame = this.levelFinished;\n    }\n  }\n\n  private _talking(customerID: string) {\n    const table = Constants.talkable as Array;\n    const index = Math.floor(Math.random() * table.length);\n    const str = table[index]\n    this.content.string = str;\n\n    const path = `texture/head/head${customerID + 1}/spriteFrame`;\n    loader.loadRes(path, SpriteFrame, (err, sp) => {\n      if (err) {\n        return;\n      }\n\n      if (this.talkNode.active) {\n        this.avatar.spriteFrame = sp;\n      }\n    })\n    this.talkNode.active = true;\n    this.scheduleOnce(() => {\n      this.talkNode.active = false;\n    }, 3)\n  }\n\n  private _showGuide(isShow: boolean) {\n    this.guildNode.active = isShow;\n\n    if (isShow) {\n      const animComp = this.guildNode.getComponent(AnimationComponent) as AnimationComponent;\n      animComp.play('showGuild');\n    }\n  }\n\n  private _refreshUI() {\n    for (let i = 0; i < this.progress.length; i++) {\n      const progress = this.progress[i];\n      if (i >= this._runtimeData.maxProgress) {\n        progress.node.active = false;\n      } else {\n        progress.node.active = true;\n        progress.spriteFrame = this.progress3\n      }\n    }\n\n    this.srcLevel.string = '1';\n    this.targetLevel.string = '2';\n    this.srcSp.spriteFrame = this.levelFinished;\n    this.targetSp.spriteFrame = this.levelUnFinished;\n  }\n}\n"]}