{"version":3,"sources":["file:///Users/qinx/coding/cocos2dx/Cocos2dx-taxi/assets/script/game/GameCtrl.ts"],"names":["_decorator","Component","Node","BoxCollider","Constants","CustomEventListener","RunTimeData","UIManager","AudioManager","CarManager","MapManager","ccclass","property","GameCtrl","type","onLoad","_reset","collider","group","getComponent","setGroup","CarGroup","NORMAL","setMask","start","showDialog","UIPage","mainUI","node","on","EventType","TOUCH_START","_touchStart","TOUCH_END","_touchEnd","EventName","GAME_START","_gameStart","GAME_OVER","_gameOver","NEW_LEVEL","_newLevel","playMusic","touch","event","carManager","controMoving","hidDialog","gameUI","resultUI","mapManager","resetMap","reset","curPath","instance","maxProgress"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAwCC,MAAAA,W,OAAAA,W;;AAC/DC,MAAAA,S,kBAAAA,S;;AACAC,MAAAA,mB,4BAAAA,mB;;AACAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,S,gBAAAA,S;;AACAC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,U,eAAAA,U;;AACAC,MAAAA,U,eAAAA,U;;;;;;;AACDC,MAAAA,O,GAAsBX,U,CAAtBW,O;AAASC,MAAAA,Q,GAAaZ,U,CAAbY,Q;;0BAGJC,Q,WADZF,OAAO,CAAC,UAAD,C,UAELC,QAAQ,CAAC;AACRE,QAAAA,IAAI;AAAA;AAAA;AADI,OAAD,C,UAKRF,QAAQ,CAAC;AACRE,QAAAA,IAAI;AAAA;AAAA;AADI,OAAD,C,UAKRF,QAAQ,CAAC;AACRE,QAAAA,IAAI,EAAEZ;AADE,OAAD,C;;;;;;;;;;;;;;;;;;;;;;;eAKFa,M,GAAP,kBAAgB;AACd,eAAKC,MAAL;;AAEA,cAAMC,QAAQ,GAAG,KAAKC,KAAL,CAAWC,YAAX,CAAwBhB,WAAxB,CAAjB;AACAc,UAAAA,QAAQ,CAACG,QAAT,CAAkB;AAAA;AAAA,sCAAUC,QAAV,CAAmBC,MAArC;AACAL,UAAAA,QAAQ,CAACM,OAAT,CAAiB,CAAC,CAAlB;AACD,S;;eAEMC,K,GAAP,iBAAe;AACb;AAAA;AAAA,sCAAUC,UAAV,CAAqB;AAAA;AAAA,sCAAUC,MAAV,CAAiBC,MAAtC;AAEA,eAAKC,IAAL,CAAUC,EAAV,CAAa3B,IAAI,CAAC4B,SAAL,CAAeC,WAA5B,EAAyC,KAAKC,WAA9C,EAA2D,IAA3D;AACA,eAAKJ,IAAL,CAAUC,EAAV,CAAa3B,IAAI,CAAC4B,SAAL,CAAeG,SAA5B,EAAuC,KAAKC,SAA5C,EAAuD,IAAvD;AACA;AAAA;AAAA,0DAAoBL,EAApB,CAAuB;AAAA;AAAA,sCAAUM,SAAV,CAAoBC,UAA3C,EAAuD,KAAKC,UAA5D,EAAwE,IAAxE;AACA;AAAA;AAAA,0DAAoBR,EAApB,CAAuB;AAAA;AAAA,sCAAUM,SAAV,CAAoBG,SAA3C,EAAsD,KAAKC,SAA3D,EAAsE,IAAtE;AACA;AAAA;AAAA,0DAAoBV,EAApB,CAAuB;AAAA;AAAA,sCAAUM,SAAV,CAAoBK,SAA3C,EAAsD,KAAKC,SAA3D,EAAsE,IAAtE;AAEA;AAAA;AAAA,4CAAaC,SAAb;AACD,S;;eAEOV,W,GAAR,qBAAoBW,KAApB,EAAkCC,KAAlC,EAAqD;AAAA;;AACnD,mCAAKC,UAAL,sEAAiBC,YAAjB;AACD,S;;eAEOZ,S,GAAR,mBAAkBS,KAAlB,EAAgCC,KAAhC,EAAmD;AAAA;;AACjD,oCAAKC,UAAL,wEAAiBC,YAAjB,CAA8B,KAA9B;AACD,S;;eAGOT,U,GAAR,sBAAqB;AACnB;AAAA;AAAA,sCAAUU,SAAV,CAAoB;AAAA;AAAA,sCAAUrB,MAAV,CAAiBC,MAArC;AACA;AAAA;AAAA,sCAAUF,UAAV,CAAqB;AAAA;AAAA,sCAAUC,MAAV,CAAiBsB,MAAtC;AACD,S;;eAEOT,S,GAAR,qBAAoB;AAClB;AAAA;AAAA,sCAAUQ,SAAV,CAAoB;AAAA;AAAA,sCAAUrB,MAAV,CAAiBsB,MAArC;AACA;AAAA;AAAA,sCAAUvB,UAAV,CAAqB;AAAA;AAAA,sCAAUC,MAAV,CAAiBuB,QAAtC;AACD,S;;eAEOR,S,GAAR,qBAAoB;AAClB;AAAA;AAAA,sCAAUM,SAAV,CAAoB;AAAA;AAAA,sCAAUrB,MAAV,CAAiBuB,QAArC;AACA;AAAA;AAAA,sCAAUxB,UAAV,CAAqB;AAAA;AAAA,sCAAUC,MAAV,CAAiBC,MAAtC;;AAEA,eAAKX,MAAL;AACD,S;;eAEOA,M,GAAR,kBAAiB;AACf,eAAKkC,UAAL,CAAiBC,QAAjB;AACA,eAAKN,UAAL,CAAiBO,KAAjB,CAAuB,KAAKF,UAAL,CAAiBG,OAAxC;AACA;AAAA;AAAA,0CAAYC,QAAZ,GAAuBC,WAAvB,GAAqC,KAAKL,UAAL,CAAgBK,WAArD;AACD,S;;;QAlE2BtD,S;;;;;iBAIH,I;;;;;;;iBAKA,I;;;;;;;iBAKX,I","sourcesContent":["\nimport { _decorator, Component, Node, EventTouch, BoxColliderComponent, BoxCollider, Vec3 } from 'cc';\nimport { Constants } from '../data/Constants';\nimport { CustomEventListener } from '../data/CustomEventListener';\nimport { RunTimeData } from '../data/GameData';\nimport { UIManager } from '../ui/UIManager';\nimport { AudioManager } from './AudioManager';\nimport { CarManager } from './CarManager';\nimport { MapManager } from './MapManager';\nconst { ccclass, property } = _decorator;\n\n@ccclass('GameCtrl')\nexport class GameCtrl extends Component {\n  @property({\n    type: MapManager\n  })\n  mapManager: MapManager = null;\n\n  @property({\n    type: CarManager\n  })\n  carManager: CarManager = null;\n\n  @property({\n    type: Node,\n  })\n  group: Node = null!;\n\n  public onLoad() {\n    this._reset();\n\n    const collider = this.group.getComponent(BoxCollider)!;\n    collider.setGroup(Constants.CarGroup.NORMAL);\n    collider.setMask(-1);\n  }\n\n  public start() {\n    UIManager.showDialog(Constants.UIPage.mainUI);\n\n    this.node.on(Node.EventType.TOUCH_START, this._touchStart, this);\n    this.node.on(Node.EventType.TOUCH_END, this._touchEnd, this);\n    CustomEventListener.on(Constants.EventName.GAME_START, this._gameStart, this);\n    CustomEventListener.on(Constants.EventName.GAME_OVER, this._gameOver, this);\n    CustomEventListener.on(Constants.EventName.NEW_LEVEL, this._newLevel, this);\n\n    AudioManager.playMusic();\n  }\n\n  private _touchStart(touch: Touch, event: EventTouch) {\n    this.carManager?.controMoving();\n  }\n\n  private _touchEnd(touch: Touch, event: EventTouch) {\n    this.carManager?.controMoving(false);\n  }\n\n\n  private _gameStart() {\n    UIManager.hidDialog(Constants.UIPage.mainUI);\n    UIManager.showDialog(Constants.UIPage.gameUI);\n  }\n\n  private _gameOver() {\n    UIManager.hidDialog(Constants.UIPage.gameUI);\n    UIManager.showDialog(Constants.UIPage.resultUI);\n  }\n\n  private _newLevel() {\n    UIManager.hidDialog(Constants.UIPage.resultUI);\n    UIManager.showDialog(Constants.UIPage.mainUI);\n\n    this._reset();\n  }\n\n  private _reset() {\n    this.mapManager!.resetMap();\n    this.carManager!.reset(this.mapManager!.curPath);\n    RunTimeData.instance().maxProgress = this.mapManager.maxProgress;\n  };\n}\n\n"]}